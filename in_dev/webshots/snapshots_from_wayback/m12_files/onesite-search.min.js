"use strict";angular.module("onesite.search",["onesite.search.services","onesite.search.factories","onesite.search.directives","onesite.search.controllers","mm.foundation"]);
"use strict";angular.module("onesite.search.factories",[]).directive("onesiteSearch",[function(){return{restrict:"E",scope:{type:"@",lang:"@",title:"@",search:"=",internalTagList:"=",nodeId:"@",resultStatus:"="},replace:!1,template:['<onesite-search-impl ng-switch="type">','<div ng-switch-when="search-result">','<onesite-search-main ng-switch="subType">','<onesite-search-main-tag ng-switch-when="tag"></onesite-search-main-tag>','<onesite-search-main-external-tag ng-switch-when="externalTag"></onesite-search-main-external-tag>',"<onesite-search-main-default ng-switch-default></onesite-search-main-default>","</onesite-search-main>","</div>",'<onesite-search-gazette ng-switch-when="ontario-gazette"></onesite-search-gazette>','<onesite-search-land-registration ng-switch-when="land_registration_all">',"</onesite-search-land-registration>",'<onesite-search-open-data ng-switch-when="open_data_landing_page"></onesite-search-open-data>','<onesite-search-order-in-council ng-switch-when="query_page_oic"></onesite-search-order-in-council>','<onesite-search-trade-calendar ng-switch-when="tradecalendar_landing_page"></onesite-search-trade-calendar>','<onesite-search-internal-tag ng-switch-when="query_landing_page"></onesite-search-internal-tag>','<onesite-search-faqs ng-switch-when="faqs"></onesite-search-faqs>',"</onesite-search-impl>"].join("")}}]).directive("onesiteSearchMain",["searchQueryFactory",function(r){return{restrict:"E",scope:!1,replace:!0,transclude:!0,require:"^onesiteSearchImpl",template:"<div ng-transclude></div>",link:function(e){var a=function(){var e={tag:new r.StringHandler({queryKey:["tag","topic","subtopic","balise"]}),externalTag:new r.StringHandler({queryKey:"external_tag"}),default:new r.StringHandler({queryKey:"query"})},a="default";for(var t in e)if(e.hasOwnProperty(t)&&e[t].model.valid){a=t;break}return{subType:a,queryHandler:e[a]}}();e.subType=a.subType,e.queryHandler=a.queryHandler}}}]).directive("onesiteSearchMainTypeahead",[function(){return{restrict:"A",scope:{type:"@",search:"=",ministry:"@",submit:"="},replace:!1,template:['<onesite-search-main-typeahead-impl ng-switch="type">','<onesite-search-main-typeahead-mobile ng-switch-when="mobile"></onesite-search-main-typeahead-mobile>',"<onesite-search-main-typeahead-default ng-switch-default></onesite-search-main-typeahead-mobile>","</onesite-search-main-formation-impl>"].join("")}}]).factory("searchQueryFactory",["$routeParams","$location","$interpolate","stringService",function(o,t,c,d){var a={},p=function(e,a){angular.isString(e)&&""!==e.trim()&&t.search(e,a).replace()};return a.StringHandler=function(e){var n,i,a,t,r,s,u,l;return n=e.queryKey,i=e.updateQuery,a=e.maxLength,t=e.lowercase,l=angular.isArray(n)?c(["{{",n.join("||"),"}}"].join(""))(o):o[n],{model:(r=t?angular.lowercase(l):l,s=a,{input:(u=angular.isString(r)&&""!==r.trim())?d.trim(r,s):null,valid:u}),updateQuery:function(e,a,t){var r=a.valid?a.input:null;t&&p(n,r),r&&i(e,r)}}},a.DateHandler=function(e){var i,s,a,t,r;return i=e.queryKey,s=e.updateQuery,{model:(a=o[i],t=d.strToDate(a),{input:(r=t&&!isNaN(t.getTime()))?t:null,valid:r}),updateQuery:function(e,a,t){var r,n=a.valid?(r=a,[d.addLeadingZeroYear(r.input.getFullYear()),d.addLeadingZeroMonth(r.input.getMonth()+1),d.addLeadingZeroDay(r.input.getDate())].join("-")):null;t&&p(i,n),n&&s(e,n)}}},a.SortHandler=function(e){var n,a,i,t,r,s,u;return n=e.queryKey,a=e.defaultAscend,i=e.updateQuery,{model:(t=o[n],r=a,s=angular.isString(t),u=r?"asc":"desc",s&&(s="asc"===(t=angular.lowercase(t.trim()))||"desc"===t),{input:s?t:u,valid:!0}),updateQuery:function(e,a,t){var r=a.valid?a.input:null;t&&p(n,r),r&&i(e,r)}}},a.OptionHandler=function(e){var s,u,a=function(e){var a=null,t=angular.isString(e)&&""!==e.trim();if(t)try{a=function(e){var a={},t=JSON.parse(e);if(!angular.isArray(t))throw new Error("invalid option");for(var r in t)if(t.hasOwnProperty(r)){if(!angular.isString(t[r]))throw new Error("invalid option");a[t[r]]=!0}return JSON.stringify(a)}(e)}catch(e){t=!1}return{input:a,valid:t}};return s=e.queryKey,u=e.updateQuery,{model:a(o[s]),updateQuery:function(e,a,t){var r,n,i=a.valid?(r=a.input,n=[],angular.forEach(JSON.parse(r),function(e,a){n.push(a)}),JSON.stringify(n)):null;t&&p(s,i),i&&u(e,i)}}},a.MainSearchTag=function(e){var a,t={template:{id:"search_all_tags"},params:{tag_type:"category.name",use_internaltag:!1,fields_returned:["title","url","type","category.name","teaser","tags.name"],must_not_filter_array:["contact","gazette_issues"]}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.MainSearchExternalTag=function(e){return angular.merge(new a.MainSearchTag(e),{params:{tag_type:"tags.name"}})},a.MainSearchInternalTag=function(e){return angular.merge(new a.MainSearchTag(e),{params:{tag_type:"internal_tags.name",use_internaltag:!0,fields_returned:["title","url","type","category.name","teaser"]}})},a.MainSearch=function(e){var a,t={template:{id:"main_searches"},params:{fields_returned:["title","url","category.name","teaser","host","type","inner_hits"],use_query:!0,use_must_filter_type:!1,must_not_filter_array:["contact","promoted_content","faq","gazette_issues"],use_sort_score:!0,use_highlight:!0,sort_direction:"desc"}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.MainSearchPromoted=function(e){var a,t={template:{id:"promoted_searches"},params:{fields_returned:["url","category.name","type","promoted_content_keyword.name","promoted_thumbnail.uri","title","teaser","content_stripped"]}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.FaqSearch=function(e){var a,t={template:{id:"get_faqs"},params:{must_be_type:"faq",use_internaltag:!1,fields_returned:["title","url","content_raw","published_at"],must_not_filter_array:["contact","promoted_content","faq"],sort_direction:"desc"}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.GazetteSearch=function(e){var a,t={template:{id:"ontario_gazette"},params:{fields_returned:["title","url","published_at","lro_uri","inner_hits","type"]}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.OrderInCouncilSearch=function(e){var a,t={template:{id:"orders_in_council"},params:{fields_returned:["title","url","published_at","type","field_oic_number","field_oic_ministry_signing","field_oic_date","field_oic_*"]}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.LandRegistrationSearch=function(e){var a,t={template:{id:"land_registration"},params:{fields_returned:["title","url","published_at","lro_uri","inner_hits","type","subtype","category.name","year_published","content_stripped"]}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.OpenDataSearch=function(e){var a,t={template:{id:"dataset"},params:{}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.TradeCalendarSearch=function(e){var a,t={template:{id:"tradecalendar"},params:{}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a.TypeAhead=function(e){var a,t={template:{id:"typeahead"},params:{fields_returned:["title","type","url"],must_not_filter_array:["faq","contact","gazette_issues","book_page"],sort_direction:"desc"}};return a=e.apiSize,angular.merge({params:{size:a}},t)},a}]);
"use strict";angular.module("onesite.search.services",[]).factory("searchDaoService",["$q","$http","$interpolate","apiEndpointConfig","redirectService","getterFactory","dataBindingService","languageService","stringService",function(i,a,e,u,r,n,t,o,c){var s={},l={hits:n.instantiate("hits.hits"),total:n.instantiate("hits.total")};s.getterHits=l;var g={id:n.instantiate("_id"),title:n.instantiate("fields.title[0]"),type:n.instantiate("fields.type[0]"),alias:function(e){var t=n.instantiate("fields.url[0]")(e);return{url:r.urlPatterns(t)}}},f={url:n.instantiate("_source.url"),highlight:function(e){return n.instantiate('highlight["content.'+o.currentLanguage.get()+'"][0]')(e)},title:n.instantiate("_source.title")};s.fileTypeGetterHit={alias:function(e){var t=n.instantiate("fields.url[0]")(e);return{url:r.urlPatterns(t),fileMime:new c.FileMime({file:t})}}},s.highlightGetterHit={highlight:function(e){var t='highlight["content.'+o.currentLanguage.get()+'"][0]';return n.instantiate(t)(e)}},s.bookPageListGetterHit={bookPageList:function(e){return t.bindDataList(e,n.instantiate("inner_hits.book_page.hits.hits"),f)}},s.tagGetterHit={category:e('{{fields["category.name"][0]}}'),teaser:n.instantiate("fields.teaser[0]")},s.GetterHit=function(e){return t=e,angular.merge({},g,t);var t};var d=function(){var n=u["onesite.search"].apiServiceCrossDomain;n=r.respectProtocol(n);return function(e,t){var r=i.defer();return e.url=[n,t].join("/"),a(e).success(function(e){r.resolve(e)}).error(function(){var e={};l.hits.assign(e,[]),l.total.assign(e,0),r.resolve(e)}),r.promise}}();return s.fetch=function(e,t){var r=u["onesite.search"].search,n={data:e,method:"POST"};if(t&&null!==e.params.keyword&&0===e.params.from){var a=i.defer();return i.all([d({data:t,method:"POST"},r),d(n,r)]).then(function(e){var t=e[0].hits.hits.length;e[0].hits.total!==t&&(e[0].hits.total=t);var r={};l.hits.assign(r,[]),l.total.assign(r,0),angular.forEach(e,function(e){l.hits.assign(r,l.hits(r).concat(l.hits(e))),l.total.assign(r,l.total(r)+l.total(e))}),a.resolve(r)},function(){a.reject()}),a.promise}return d(n,r)},s}]).factory("searchService",["$q","urlConfig","dataBindingService","stringService","listService","languageService","debounceService","searchDaoService",function(s,u,o,c,l,g,f,d){var e={},m=d.getterHits,h=function(e,t){return{resultList:o.bindDataList(e,m.hits,t),total:m.total(e)}};return e.MainSearch=function(e){return a=e.queryTemplate,i=e.queryPomotedTemplate,t=e.getterHit,r=e.delay,u=new f.SoftDebouncer({delay:r,submitMethod:d.fetch,onSuccess:function(e){return h(e,t)}}),{search:function(e,t){var r={params:{lang:g.currentLanguage.get(),from:e}},n={params:{keyword:t.query.keyword.model.valid?t.query.keyword.model.input:null}};return angular.merge(n,r,i),angular.merge(r,a),angular.forEach(t.query,function(e){e.updateQuery(r,e.model)}),u(r,n)}};var a,i,t,r,u},e.TagSearch=function(e){return i=e.queryTemplate,u=e.getterHit,{search:function(e,t){var r,n,a={params:{lang:g.currentLanguage.get(),from:e}};return angular.merge(a,i),angular.forEach(t.query,function(e){e.updateQuery(a,e.model)}),r=a,n=s.defer(),d.fetch(r).then(function(e){n.resolve(h(e,u))},function(){n.reject()}),n.promise}};var i,u},e.InternalTagSearch=function(e){return i=e.queryTemplate,u=e.getterHit,o=e.id,c=e.keywordList,{search:function(e,t){var r,n,a={params:{lang:g.currentLanguage.get(),from:e,must_not_nid:o,keyword:c}};return angular.merge(a,i),angular.forEach(t.query,function(e){e.updateQuery(a,e.model)}),r=a,n=s.defer(),d.fetch(r).then(function(e){n.resolve(h(e,u))},function(){n.reject()}),n.promise}};var i,u,o,c},e.FaqSearch=function(e){return i=e.queryTemplate,u=e.getterHit,o=e.id,c=e.keywordList,{search:function(e,t){var r,n,a={params:{lang:g.currentLanguage.get(),from:e,must_not_nid:o,raw_internal_tags:c}};return angular.merge(a,i),angular.forEach(t.query,function(e){e.updateQuery(a,e.model)}),r=a,n=s.defer(),d.fetch(r).then(function(e){n.resolve(h(e,u))},function(){n.reject()}),n.promise}};var i,u,o,c},e.GazetteSearch=function(e){return a=e.queryTemplate,t=e.getterHit,r=e.delay,i=new f.SoftDebouncer({delay:r,submitMethod:d.fetch,onSuccess:function(e){return h(e,t)}}),{search:function(e,t,r){var n={params:{lang:g.currentLanguage.get(),from:e}};return angular.merge(n,a),angular.forEach(t.query,function(e){e.updateQuery(n,e.model,r)}),i(n)}};var a,t,r,i},e.OrderInCouncilSearch=function(e){return a=e.queryTemplate,t=e.getterHit,r=e.delay,i=new f.SoftDebouncer({delay:r,submitMethod:d.fetch,onSuccess:function(e){return h(e,t)}}),{search:function(e,t,r){var n={params:{lang:g.currentLanguage.get(),from:e}};return angular.merge(n,a),angular.forEach(t.query,function(e){e.updateQuery(n,e.model,r)}),i(n)}};var a,t,r,i},e.LandRegistrationSearch=function(e){return a=e.queryTemplate,t=e.getterHit,r=e.delay,i=new f.SoftDebouncer({delay:r,submitMethod:d.fetch,onSuccess:function(e){return h(e,t)}}),{search:function(e,t,r){var n={params:{lang:g.currentLanguage.get(),from:e}};return angular.merge(n,a),angular.forEach(t.query,function(e){e.updateQuery(n,e.model,r)}),i(n)}};var a,t,r,i},e.OpenDataSearch=function(e){return a=e.queryTemplate,t=e.getterHit,r=e.getOptions,n=e.delay,i=new f.SoftDebouncer({delay:n,submitMethod:d.fetch,onSuccess:function(e){return angular.extend(h(e,t),{options:r(e)})}}),{search:function(e,t,r){var n={params:{lang:g.currentLanguage.get(),from:e}};return angular.merge(n,a),angular.forEach(t.query,function(e){e.updateQuery(n,e.model,r)}),i(n)},listFilters:function(){var e={params:{lang:g.currentLanguage.get(),from:0}};return angular.merge(e,a),e.params.size=0,d.fetch(e).then(function(e){return{options:r(e),total:o.bindData(e,d.getterHits).total}})}};var a,t,r,n,i},e.TradeCalendarSearch=function(e){return a=e.queryTemplate,t=e.getterHit,r=e.getOptions,n=e.delay,i=new f.SoftDebouncer({delay:n,submitMethod:d.fetch,onSuccess:function(e){return angular.extend(h(e,t),{options:r(e)})}}),{search:function(e,t,r){var n={params:{lang:g.currentLanguage.get(),from:e}};return angular.merge(n,a),angular.forEach(t.query,function(e){e.updateQuery(n,e.model,r)}),i(n)},listFilters:function(){var e={params:{lang:g.currentLanguage.get(),from:0}};return angular.merge(e,a),e.params.size=0,d.fetch(e).then(function(e){return{options:r(e),total:o.bindData(e,d.getterHits).total}})}};var a,t,r,n,i},e.TypeAheadSearch=function(e){return t=e.queryTemplate,r=e.getterHit,n=e.delay,a=e.maxLength,i=new f.SoftDebouncer({delay:n,submitMethod:function(e){return d.fetch(angular.merge(t,{params:{keyword:e,lang:g.currentLanguage.get()}}))},onSuccess:function(e){var t=l.typeahead.call(o.bindDataList(e,m.hits,r),"alias.url");return t.forEach(function(e,t){e.index=t+1}),t[0]?[{url:u.pathPrefix,title:""}].concat(t):[]}}),function(e){return i(c.escape(c.trim(e,a)))};var t,r,n,a,i},e}]).factory("onesiteSearchLandRegistrationFilters",[function(){return{en:{boundaries:"Boundaries Act",condominium:"Condominium Act 1998",registry:"Registry Act",titles:"Land Titles Act",reform:"Land Registration Reform Act"},fr:{bornage:"Loi sur le bornage",condominiums:"Loi de 1998 sur les condominiums",actes:"Loi sur l'enregistrement des actes",droits:"Loi sur l'enregistrement des droits immobiliers","réforme":"Loi portant réforme de l'enregistrement immobilier"}}}]);
"use strict";angular.module("onesite.search.directives",[]).directive("onesiteSearchImpl",["scrollService","redirectService","analyticsTypeaheadService","$timeout","$location",function(i,r,l,o,u){var s=function(e){var a=this;e.pageIdx++,o(function(){var e=angular.element(a[0]).parent().find(".last_range");if(e[0]){var t=e.find("a");t[0]&&t[0].focus();var n=angular.element(a[0]).parent().find('[scroll-paginate="true"]');i.scrollToElement(n,15)}},0,!1)},c=function(e){var t=this.find(e)[0];t&&angular.isFunction(t.focus)&&t.focus()};return{restrict:"E",scope:!1,replace:!0,transclude:!0,controller:"OnesiteSearchImpl as onesiteSearchImpl",template:"<div ng-transclude></div>",link:function(t,n,e,a){a.lang=t.lang,a.config={delay:333,maxLength:1024,apiSize:20},a.config.pageSize=Math.min(20,a.config.apiSize),t.aliasToPath=r.aliasToPath,t.$location=u,t.init=function(e){return a.filterHandler.submit.search(0,a.filterHandler,e).then(a.initResultList).then(function(e){return t.resultStatus.total=a.total,t.resultStatus.pageIdx=a.pageIdx,e})},t.loadMore=function(){!a.pagination[a.pageIdx+2]||a.pagination[a.pageIdx+2]<a.config.pageSize?a.filterHandler.submit.search(a.resultList.length,a.filterHandler).then(function(e){a.appendToResultList(e),s.call(n,a),t.resultStatus.pageIdx=a.pageIdx}):s.call(n,a)},t.focusOnElement=function(e,t){t?o(function(){c.call(n,e)},0):c.call(n,e)},t.logAnalytics=function(e,t,n,a){l(e,t,[n],a)}}}}]).directive("onesiteSearchMainTag",["searchQueryFactory","searchService","languageService","searchDaoService",function(r,l,o,u){return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/main/onesiteSearch.html",link:function(e,t,n,a){var i;a.config.resultPageType="page",a.filterHandler=((i=a.config).queryTemplate=new r.MainSearchTag(i),i.getterHit=new u.GetterHit(u.tagGetterHit,u.highlightGetterHit),{query:{tag:new r.StringHandler({queryKey:["tag","topic","subtopic","balise"],maxLength:i.maxLength,updateQuery:function(e,t){e.params.keyword=t}}),contentType:new r.StringHandler({queryKey:"type",maxLength:i.maxLength,updateQuery:function(e,t){e.params.bools=!0,e.params.type=angular.lowercase(t)}})},submit:new l.TagSearch(i)}),a.searchType="tag",document.title=[a.filterHandler.query.tag.model.valid?[o.translate("Pages",a.lang),o.translate("within the topic",a.lang)+":",a.filterHandler.query.tag.model.input].join(" "):o.translate("Pages",a.lang),"|","Ontario.ca"].join(" "),e.search.input="",e.init()}}}]).directive("onesiteSearchMainExternalTag",["searchQueryFactory","searchService","languageService","searchDaoService",function(r,l,o,u){return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/main/onesiteSearch.html",link:function(e,t,n,a){var i;a.config.resultPageType="page",a.filterHandler=((i=a.config).queryTemplate=new r.MainSearchExternalTag(i),i.getterHit=new u.GetterHit(u.tagGetterHit,u.highlightGetterHit),{query:{externalTag:new r.StringHandler({queryKey:"external_tag",maxLength:i.maxLength,updateQuery:function(e,t){e.params.keyword=t}})},submit:new l.TagSearch(i)}),a.searchType="external_tag",document.title=[a.filterHandler.query.externalTag.model.valid?[o.translate("Pages",a.lang),o.translate("within the topic",a.lang)+":",a.filterHandler.query.externalTag.model.input].join(" "):o.translate("Pages",a.lang),"|","Ontario.ca"].join(" "),e.search.input="",e.init()}}}]).directive("onesiteSearchMainDefault",["searchQueryFactory","searchService","languageService","searchDaoService","stringService","getterFactory","$interpolate","$parse","$filter",function(r,l,o,u,s,e,t,n,c){var d={category:t('{{fields["category.name"][0]}}'),teaser:e.instantiate("fields.teaser[0]"),host:e.instantiate("fields.host[0]"),promoted_thumbnail:t('{{fields["promoted_thumbnail.uri"][0]}}'),contentStripped:e.instantiate("fields.content_stripped[0]")};return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/main/onesiteSearch.html",link:function(e,t,n,a){var i;a.filterHandler=((i=a.config).queryTemplate=new r.MainSearch(i),i.queryPomotedTemplate=new r.MainSearchPromoted({apiSize:1}),i.getterHit=angular.merge({},d,u.fileTypeGetterHit,u.highlightGetterHit,u.bookPageListGetterHit),i.getterHit=new u.GetterHit(i.getterHit),{query:{keyword:new r.StringHandler({queryKey:"query",maxLength:i.maxLength,updateQuery:function(e,t){e.params.keyword=s.escape(t)}}),contentType:new r.StringHandler({queryKey:"type",maxLength:i.maxLength,updateQuery:function(e,t){e.params.type=angular.lowercase(t),e.params.must_not_filter_array=c("filter")(e.params.must_not_filter_array,"!"+e.params.type),e.params.use_must_filter_type=!0}})},submit:new l.MainSearch(i)}),a.searchType="query",document.title=[a.filterHandler.query.keyword.model.valid?[e.title,o.translate("for",a.lang),a.filterHandler.query.keyword.model.input].join(" "):o.translate("Pages",a.lang),"|","Ontario.ca"].join(" "),e.search.input=a.filterHandler.query.keyword.model.valid?a.filterHandler.query.keyword.model.input:"",e.init()}}}]).directive("onesiteSearchOrderInCouncil",["searchQueryFactory","searchService","scrollService","searchDaoService","getterFactory","dataBindingService","languageService","stringService","$interpolate","$timeout","analyticsPageViewService",function(r,l,o,u,s,e,c,d,p,g,f){return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/orderInCouncil/onesiteSearch.html",link:function(e,i,t,n){var a;n.filterHandler=((a=n.config).queryTemplate=new r.OrderInCouncilSearch(a),a.getterHit=new u.GetterHit({url:s.instantiate("fields.url[0]"),datePublished:function(e){var t=s.instantiate("fields.published_at[0]")(e);if(angular.isString(t)&&""!==t.trim())return/^[0-9]*$/.test(t)?(t=parseInt(t),angular.isNumber(t)?1e3*t:null):(t=d.strToDate(t).getTime(),isNaN(t)?null:t)},highlight:function(e){return p('{{highlight["pdf_contents"][0] || highlight["content.'+c.currentLanguage.get()+'"][0] }}')(e)},oic_date:function(e){var t=s.instantiate("fields.field_oic_date[0]")(e);if(angular.isString(t)&&""!==t.trim())return/^[0-9]*$/.test(t)?(t=parseInt(t),angular.isNumber(t)?1e3*t:null):(t=d.strToDate(t).getTime(),isNaN(t)?null:t)},oic_number:s.instantiate("fields.field_oic_number[0]"),oic_ministry_signing:s.instantiate("fields.field_oic_ministry_signing[0]"),oic_acts:function(e){var t=s.instantiate("_source.field_oic_acts")(e),n=[];return void 0!==t?(t.map(function(e){n.push(e.name)}),n):["No act"]}}),{query:{keyword:new r.StringHandler({queryKey:"query",updateQuery:function(e,t){e.params.keyword=d.escape(d.hasDoubleQuotes(t)?d.stripDoubleQuotes(t):t)}}),exactMatch:new r.StringHandler({queryKey:"exact_match",updateQuery:function(e,t){e.params.exactMatch=d.hasDoubleQuotes(t)?"true":""}}),contentType:new r.StringHandler({queryKey:"type",maxLength:a.maxLength,updateQuery:function(e,t){e.params.type=angular.lowercase(t)}}),oicnumber:new r.StringHandler({queryKey:"oicnumber",updateQuery:function(e,t){e.params.oicnumber=d.escape(t)}}),fromDate:new r.DateHandler({queryKey:"date_from",updateQuery:function(e,t){e.params.dateFrom=t}}),toDate:new r.DateHandler({queryKey:"date_to",updateQuery:function(e,t){e.params.dateTo=t}}),sort:new r.SortHandler({queryKey:"sort",defaultAscend:!1,updateQuery:function(e,t){e.params.order=t}})},submit:new l.OrderInCouncilSearch(a)}),n.searchType="orderInCouncil",e.logPageView=f.logPageView,e.pdfFileMime=new d.FileMime({file:"pdf"}),e.toggleView=function(t){var n=angular.element(i[0]).parent().find('[scroll-to-list="true"]'),a=i.find('[focus-to-list="true"]')[0];g(function(){g(function(){var e=angular.element('[scroll-to-detail="true"]');o.scrollToElement(t?n:e,null,15),a&&angular.isFunction(a.focus)&&a.focus()},0,!1)},0,!1)},e.current.keyword=n.filterHandler.query.keyword.model.input,e.search.input="",e.init()}}}]).directive("onesiteSearchGazette",["searchQueryFactory","searchService","scrollService","searchDaoService","getterFactory","dataBindingService","languageService","stringService","$interpolate","$timeout","analyticsPageViewService",function(r,l,o,u,s,c,d,p,g,f,y){var m={url:s.instantiate("_source.url"),highlight:function(e){return s.instantiate('highlight["content.'+d.currentLanguage.get()+'"][0]')(e)},title:s.instantiate("_source.title")};return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/gazette/onesiteSearch.html",link:function(e,i,t,n){var a;n.filterHandler=((a=n.config).queryTemplate=new r.GazetteSearch(a),a.getterHit=new u.GetterHit({landRegistrationFile:s.instantiate("fields.lro_uri[0]"),url:s.instantiate("fields.url[0]"),datePublished:function(e){var t=s.instantiate("fields.published_at[0]")(e);if(angular.isString(t)&&""!==t.trim())return/^[0-9]*$/.test(t)?(t=parseInt(t),angular.isNumber(t)?1e3*t:null):(t=p.strToDate(t).getTime(),isNaN(t)?null:t)},highlight:function(e){return g('{{highlight["pdf_contents"][0] || highlight["content.'+d.currentLanguage.get()+'"][0] }}')(e)},bookPageList:function(e){return c.bindDataList(e,s.instantiate("inner_hits.book_page.hits.hits"),m)}}),{query:{keyword:new r.StringHandler({queryKey:"query",updateQuery:function(e,t){e.params.keyword=p.escape(t)}}),contentType:new r.StringHandler({queryKey:"type",maxLength:a.maxLength,updateQuery:function(e,t){e.params.type=angular.lowercase(t)}}),fromDate:new r.DateHandler({queryKey:"date_from",updateQuery:function(e,t){e.params.dateFrom=t+"T00:00:00.000Z"}}),toDate:new r.DateHandler({queryKey:"date_to",updateQuery:function(e,t){e.params.dateTo=t+"T23:59:59.000Z"}})},submit:new l.GazetteSearch(a)}),n.searchType="gazette",e.logPageView=y.logPageView,e.pdfFileMime=new p.FileMime({file:"pdf"}),e.toggleView=function(t){var n=angular.element(i[0]).parent().find('[scroll-to-list="true"]'),a=i.find('[focus-to-list="true"]')[0];f(function(){f(function(){var e=angular.element('[scroll-to-detail="true"]');o.scrollToElement(t?n:e,null,15),a&&angular.isFunction(a.focus)&&a.focus()},0,!1)},0,!1)},e.current.keyword=n.filterHandler.query.keyword.model.input,e.search.input="",e.init()}}}]).directive("onesiteSearchLandRegistration",["searchQueryFactory","searchService","scrollService","getterFactory","searchDaoService","dataBindingService","languageService","stringService","$interpolate","$timeout","$q","analyticsPageViewService","onesiteSearchLandRegistrationFilters",function(t,n,e,a,i,r,l,o,u,s,c,d,p){var g={url:a.instantiate("_source.url"),highlight:function(e){return a.instantiate('highlight["content.'+l.currentLanguage.get()+'"][0]')(e)},title:a.instantiate("_source.title")},f={memos:!0,"notes de service":!0,bulletins:!0},y=function(e){return e.queryTemplate=new t.LandRegistrationSearch(e),e.getterHit=new i.GetterHit({landRegistrationFile:a.instantiate("fields.lro_uri[0]"),url:a.instantiate("fields.url[0]"),category:a.instantiate("fields['category.name'][2]"),yearPublished:a.instantiate("fields.year_published[0]"),subtype:a.instantiate("fields.subtype[0]"),linkToFile:function(e){var t=a.instantiate("fields.content_stripped[0]")(e);return!angular.isString(t)||""===t.trim()},datePublished:function(e){var t=a.instantiate("fields.published_at[0]")(e);return angular.isString(t)&&""!==t.trim()&&(t=o.strToDate(t).getTime()),isNaN(t)?null:t},highlight:function(e){return u('{{highlight["pdf_contents"][0] || highlight["content.'+l.currentLanguage.get()+'"][0] }}')(e)},bookPageList:function(e){return r.bindDataList(e,a.instantiate("inner_hits.book_page.hits.hits"),g)}}),{query:{keyword:new t.StringHandler({queryKey:"query",updateQuery:function(e,t){e.params.keyword=o.escape(t)}}),bulletins:new t.StringHandler({queryKey:"field_bulletins_year_value",updateQuery:function(e){e.params.subtype="bulletins"}}),forms:new t.StringHandler({queryKey:"field_forms_act_tid",updateQuery:function(e,t){e.params.topic=function(){var e=l.currentLanguage.get();for(var t in p)if(p.hasOwnProperty(t)&&t===e){var n=p[t];return Object.keys(n)}return!0}().includes(t)?t:null,e.params.subtype="forms",e.params.subtype2="formulaires"},lowercase:!0}),memos:new t.StringHandler({queryKey:"field_memos_year_value",updateQuery:function(e){e.params.subtype="memos",e.params.subtype2="notes de service"}}),orders:new t.StringHandler({queryKey:"field_order_types_tid",updateQuery:function(e){e.params.subtype="orders",e.params.subtype2="ordonnances"},lowercase:!0}),guides:new t.StringHandler({queryKey:"field_guides_tid",updateQuery:function(e){e.params.subtype="guides"},lowercase:!0}),articles:new t.StringHandler({queryKey:"field_articles_tid",updateQuery:function(e){e.params.subtype="articles"},lowercase:!0}),auth:new t.StringHandler({queryKey:"field_land_registration_authoriz_tid",updateQuery:function(e){e.params.subtype="Authorization",e.params.subtype2="Autorisation"},lowercase:!0}),fund:new t.StringHandler({queryKey:"field_land_titles_assurance_fund_tid",updateQuery:function(e){e.params.subtype="Fund",e.params.subtype2="Caisse"},lowercase:!0}),sort:new t.SortHandler({queryKey:"sort",defaultAscend:!1,updateQuery:function(e,t){e.params.order=t}})},submit:new n.LandRegistrationSearch(e)}},m=function(e){var t=(new Date).getFullYear();return angular.isNumber(e)?{min:e,range:Math.max(t-e,0)+1}:{min:null,range:null}};return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/landRegistration/onesiteSearch.html",link:function(n,e,t,a){a.filterHandler=y(a.config),a.searchType="landRegistration",n.logPageView=d.logPageView,n.pdfFileMime=new o.FileMime({file:"pdf"}),n.subTypeShowYearCollection=f,n.getYearRange=m,n.current.keyword=a.filterHandler.query.keyword.model.input,n.search.input="",n.initAfterDigest=function(e){var t=c.defer();return s(function(){n.init(e).then(function(){t.resolve()},function(){t.reject()})}),t.promise},n.selectOption=function(e){return function(e){if(e.model.valid=e.model.valid||angular.isString(e.model.input)&&""!==angular.isString(e.model.input),e.model.valid)return this.init(!0);var t=c.defer();return t.reject(),t.promise}.call(n,e)},n.updateOptions=function(e,t){angular.forEach(e,function(e){a.filterHandler.query[e.key].model.valid=e.key===t})},n.enableScreenReaderTotal=function(){s(function(){a.enableScreenReaderTotal=!0},0)},n.focusOnSearchButton=function(){n.focusOnElement('input[type="submit"]')}}}}]).directive("onesiteSearchOpenData",["searchQueryFactory","searchService","scrollService","componentDaoService","componentService","searchDaoService","getterFactory","dataBindingService","languageService","stringService","onesiteFoundationService","analyticsPageViewService","$timeout",function(r,l,e,o,u,s,c,d,t,p,g,f,y){var m={key:c.instantiate("key"),description:c.instantiate("doc_count")},h={fileMime:function(e){return new p.FileMime({file:e.name,fallback:!0})}},S=function(e){var t=angular.isString(e.title)?e.title.split("||"):[];return e.aggregate=!!t[1],e.aggregate&&(e.title=t[0].trim()),e.mime=new p.FileMime({file:e.url}),e},v={title:c.instantiate("description"),url:c.instantiate("uri")},_={title:c.instantiate("title"),url:c.instantiate("url")},w=function(e){return o.getterTag.name.assign(e,e.name),e},b=function(e){return new p.FileMime({file:e})},q=function(e,t){var n=t.reduce(function(e,t){return e[t.key]=t.description,e},{});angular.forEach(this.filterCollection[e].list,function(e){e.description=n[e.key]||"0"})};return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/openData/onesiteSearch.html",link:function(a,e,t,n){var i;a.makeFileMime=b,a.onesiteFoundationService=g,a.logPageView=f.logPageView,n.datasetStatusMap=o.datasetStatusMap,n.filterHandler=((i=n.config).queryTemplate=new r.OpenDataSearch(i),i.getterHit=new s.GetterHit({alias:c.instantiate("_source.id"),title:c.instantiate("_source.title"),contentStripped:c.instantiate("_source.content_stripped"),content:c.instantiate("_source.content"),tags:function(e){var t=c.instantiate("_source.lang")(e),n=(c.instantiate("_source.tag_list")(e)||[]).map(w),a=c.instantiate("_source.id")(e),i={};o.tags.getter.lang.assign(i,t),o.tags.getter.tagList.assign(i,n);var r={content:{}};return u.tags.call(r,i,{alias:a},null,o.tags.getter),r.content.tags},intro:c.instantiate("_source.intro"),fileTypeList:function(e){var l,o;return d.bindDataList(e,c.instantiate("_source.opendata_file_type_used"),h).filter((l="fileMime",o="abbr",function(e,t,n){for(var a=n.length,i=!0,r=0;r<a;r++)if(t<r&&n[r][l][o]===e[l][o]){i=!1;break}return i}))},topicList:c.instantiate("_source.category"),publisherList:c.instantiate("_source.ministries"),datePublished:function(e){var t=c.instantiate("_source.published_at")(e);return angular.isString(t)&&""!==t.trim()&&(t=p.strToDate(t).getTime()),isNaN(t)?null:t},dateModified:function(e){var t=c.instantiate("_source.last_changed")(e);return angular.isString(t)&&""!==t.trim()&&(t=parseInt(t)),angular.isNumber(t)?1e3*t:null},dateDataUpdated:function(e){var t=c.instantiate("_source.field_data_updated_date")(e);return angular.isString(t)&&""!==t.trim()&&(t=parseInt(t)),angular.isNumber(t)?1e3*t:null},updateFrequency:c.instantiate("_source.opendata_update_frequency"),geographicalCoverage:c.instantiate("_source.opendata_geographical_coverage"),license:c.instantiate("_source.intellectual_property_url[0]"),fileList:function(e){return d.bindDataList(e,c.instantiate("_source.opendata_records_file"),v).concat(d.bindDataList(e,c.instantiate("_source.opendata_external_file_link"),_)).map(S)},status:function(e){var t=c.instantiate("_source.status")(e);return t?o.datasetStatusMap[t]:null}}),i.getOptions=function(e){return{status:d.bindDataList(e,c.instantiate("aggregations.status.buckets"),m),topic:d.bindDataList(e,c.instantiate("aggregations.topic.buckets"),m),publisher:d.bindDataList(e,c.instantiate("aggregations.publisher.buckets"),m),fileType:d.bindDataList(e,c.instantiate("aggregations.fileType.buckets"),m)}},{query:{keyword:new r.StringHandler({queryKey:"query",maxLength:i.maxLength,updateQuery:function(e,t){e.params.query=p.escape(t)}}),status:new r.OptionHandler({queryKey:"status",updateQuery:function(e,t){t=JSON.parse(t),e.params["status?"]=t[0]&&o.datasetStatusMap[t[0]]?{list:t}:{isEmpty:!0}}}),topic:new r.OptionHandler({queryKey:"topic",updateQuery:function(e,t){t=JSON.parse(t),e.params["topic?"]=t[0]?{list:t}:{isEmpty:!0}}}),publisher:new r.OptionHandler({queryKey:"publisher",updateQuery:function(e,t){t=JSON.parse(t),e.params["publisher?"]=t[0]?{list:t}:{isEmpty:!0}}}),fileType:new r.OptionHandler({queryKey:"filetype",updateQuery:function(e,t){t=JSON.parse(t),e.params["fileType?"]=t[0]?{list:t}:{isEmpty:!0}}}),sort:new r.SortHandler({queryKey:"sort",defaultAscend:!0,updateQuery:function(e,t){"asc"===t||"desc"===t?e.params.order=t:"datemodified"===t?e.params.datemodified="desc":"dateadded"===t?e.params.dateadded="desc":"updatefrequency"===t&&(e.params.updatefrequency="asc")}})},submit:new l.OpenDataSearch(i),checkAllWhenSelectAll:!1,updateDescription:!1}),a.search.input="",n.filterHandler.submit.listFilters().then(function(e){a.dataSetVolume=e.total;var n={};angular.forEach(e.options,function(e,t){n[t]={list:e,update:function(e){q.call(a,t,e.options[t])}}}),a.filterCollection=n,a.init()}),a.resetAllFilters=function(){angular.forEach(a.filterCollection,function(e,t){n.filterHandler.query[t].select.individual={},angular.forEach(e.list,function(e){e.input=n.filterHandler.checkAllWhenSelectAll}),n.filterHandler.query[t].model.input=JSON.stringify(null),n.filterHandler.query[t].model.valid=!1}),a.init(!0).then(function(n){angular.forEach(a.filterCollection,function(e,t){q.call(a,t,n.options[t])})})},a.focusFirstResult=function(){y(function(){a.focusOnElement("a[focus-paginate-first-result=true]")},0)},a.enableScreenReaderTotal=function(){n.enableScreenReaderTotal=!0},a.focusOnSearchButton=function(){a.focusOnElement('button[focus-on-search-button="true"]')}}}}]).directive("onesiteSearchTradeCalendar",["searchQueryFactory","searchService","scrollService","componentService","onesiteFoundationService","analyticsPageViewService","searchDaoService","getterFactory","dataBindingService","languageService","stringService","$timeout",function(r,l,e,t,o,u,s,c,d,n,p,g){var f={key:c.instantiate("key"),description:c.instantiate("doc_count")},y=function(e){return angular.isString(e)?p.strToDate(e.split(" ")[0]):null},m=function(e,t){var n=t.reduce(function(e,t){return e[t.key]=t.description,e},{});angular.forEach(this.filterCollection[e].list,function(e){e.description=n[e.key]||"0"})};return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/tradeCalendar/onesiteSearch.html",link:function(a,e,t,n){var i;a.onesiteFoundationService=o,a.logPageView=u.logPageView,a.onSubmitDate=function(){n.filterHandler.queryCombined.date.valid=n.filterHandler.query.fromDate.model.valid||n.filterHandler.query.toDate.model.valid,n.filterHandler.dirty=n.filterHandler.dirty||n.filterHandler.queryCombined.date.valid},n.filterHandler=((i=n.config).queryTemplate=new r.TradeCalendarSearch(i),i.getterHit=new s.GetterHit({id:c.instantiate("_id"),alias:c.instantiate("_source.id"),title:c.instantiate("_source.title"),contentStripped:c.instantiate("_source.content_stripped"),content:c.instantiate("_source.content"),sector:c.instantiate("_source.sector"),sectorOther:c.instantiate("_source.sector_other"),region:c.instantiate("_source.region"),eventLocation:c.instantiate("_source.event_location"),fromDate:function(e){return y(c.instantiate("_source.event_date[0].from")(e))},toDate:function(e){return y(c.instantiate("_source.event_date[0].to")(e))},contactName:c.instantiate("_source.contact"),contactTitle:c.instantiate("_source.job_title"),contactPosition:c.instantiate("_source.contact_position"),contactEmail:c.instantiate("_source.email"),contactTelephone:c.instantiate("_source.telephone"),lastChanged:function(e){var t=c.instantiate("_source.last_changed")(e);return t?t+"000":null}}),i.getOptions=function(e){return{sector:d.bindDataList(e,c.instantiate("aggregations.sector.buckets"),f),region:d.bindDataList(e,c.instantiate("aggregations.region.buckets"),f)}},{query:{keyword:new r.StringHandler({queryKey:"query",maxLength:i.maxLength,updateQuery:function(e,t){e.params.query=p.escape(t)}}),sector:new r.OptionHandler({queryKey:"sector",updateQuery:function(e,t){t=JSON.parse(t),e.params["sector?"]=t[0]?{list:t}:{isEmpty:!0}}}),region:new r.OptionHandler({queryKey:"region",updateQuery:function(e,t){t=JSON.parse(t),e.params["region?"]=t[0]?{list:t}:{isEmpty:!0}}}),fromDate:new r.DateHandler({queryKey:"from",updateQuery:function(e,t){e.params["fromDate?"]={gte:t}}}),toDate:new r.DateHandler({queryKey:"to",updateQuery:function(e,t){e.params["toDate?"]={lte:t}}}),sort:new r.SortHandler({queryKey:"sort",defaultAscend:!0,updateQuery:function(e,t){e.params["sort?"]={order:t}}})},submit:new l.TradeCalendarSearch(i),checkAllWhenSelectAll:!1,updateDescription:!1}),n.filterHandler.query.fromDate.model.valid||(n.filterHandler.query.fromDate.model.input=new Date,n.filterHandler.query.fromDate.model.valid=!0),a.search.input="",n.filterHandler.submit.listFilters().then(function(e){var n={};angular.forEach(e.options,function(e,t){n[t]={list:e,update:function(e){m.call(a,t,e.options[t])}}}),a.filterCollection=n,a.init()}),a.resetAllFilters=function(){angular.forEach(a.filterCollection,function(e,t){n.filterHandler.query[t].select.individual={},angular.forEach(e.list,function(e){e.input=n.filterHandler.checkAllWhenSelectAll}),n.filterHandler.query[t].model.input=JSON.stringify(null),n.filterHandler.query[t].model.valid=!1}),a.init(!0).then(function(n){angular.forEach(a.filterCollection,function(e,t){m.call(a,t,n.options[t])})})},a.focusFirstResult=function(){g(function(){a.focusOnElement("a[focus-paginate-first-result=true]")},0)},a.enableScreenReaderTotal=function(){n.enableScreenReaderTotal=!0}}}}]).directive("onesiteSearchInternalTag",["searchQueryFactory","searchService","searchDaoService",function(r,l,o){return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/landing/onesiteSearch.html",link:function(e,t,n,a){var i;a.config.resultPageType="page",a.config.id=e.nodeId,a.config.keywordList=e.internalTagList,a.filterHandler=((i=a.config).queryTemplate=new r.MainSearchInternalTag(i),i.getterHit=new o.GetterHit(o.tagGetterHit,o.highlightGetterHit),{query:{contentType:new r.StringHandler({queryKey:"type",maxLength:i.maxLength,updateQuery:function(e,t){e.params.bools=!0,e.params.type=angular.lowercase(t)}})},submit:new l.InternalTagSearch(i)}),a.searchType="internal_tags",e.search.input="",e.init()}}}]).directive("onesiteSearchFaqs",["searchService","searchDaoService","getterFactory","searchQueryFactory",function(r,l,o,u){return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchImpl",templateUrl:"/onesite_modules/onesite-search/partials/faqs/onesiteSearch.html",link:function(e,t,n,a){var i;a.config.id=e.nodeId,a.config.keywordList=e.internalTagList,a.filterHandler=((i=a.config).queryTemplate=new u.FaqSearch(i),i.getterHit=new l.GetterHit({content:o.instantiate("fields.content_raw[0]")}),{submit:new r.FaqSearch(i)}),a.searchType="faqs",e.internalTagList[0]&&e.init()}}}]).directive("onesiteOptionFilter",[function(){var a=function(e){e.select.all=null===e.model.input,e.select.none="{}"===e.model.input,e.select.individual=JSON.parse(e.model.input)||{}},i=function(e){e.input=!0},r=function(e){e.input=!1},l=function(e,t,n){e.select.all?(e.select.individual={},angular.forEach(t,n?i:r),e.model.input=JSON.stringify(null),e.model.valid=!1):e.select.none?(e.select.individual={},angular.forEach(t,r),e.model.input=JSON.stringify(e.select.individual),e.model.valid=!0):e.select.all||e.select.none||(e.select.individual=t.reduce(function(e,t){return e[t.key]=!0,e},{}),angular.equals(e.select.individual,{})&&!n?(angular.forEach(t,r),e.model.input=JSON.stringify(null),e.model.valid=!1):(e.model.input=JSON.stringify(e.select.individual),e.model.valid=!0))};return{restrict:"E",scope:!1,replace:!0,template:'<div ng-include="templateUrl"></div>',link:function(e,t,n){e.templateUrl=n.templateUrl,e.extractOptions=a,e.updateOptions=l}}}]).directive("onesiteSearchMainTypeaheadImpl",["searchService","searchDaoService","searchQueryFactory","$timeout",function(r,l,o,u){return{restrict:"E",scope:!1,replace:!0,transclude:!0,controller:"OnesiteSearchMainTypeaheadImpl as onesiteSearchMainTypeaheadImpl",template:"<div ng-transclude></div>",link:function(t,n,e,a){a.config={delay:333,minLength:2,maxLength:1024},a.config.queryTemplate=new o.TypeAhead({apiSize:5}),a.config.getterHit=new l.GetterHit(l.fileTypeGetterHit),a.typeaheadHandler=new r.TypeAheadSearch(a.config),t.init=function(){a.inputElement=angular.element(n).find("input")},t.enableInputCheck=!0,a.cacheInput=t.search.input,t.search.resetInput.push(function(){a.cacheInput=null,t.search.input=null});var i={8:a.clearInput,9:a.tabThroughSuggestions,13:a.redirect,27:a.clearInput};t.searchByKeyword=function(e){angular.isFunction(i[e.keyCode])&&i[e.keyCode].call(t)},t.clear=function(e){13!==e.keyCode&&"click"!==e.type||(a.cacheInput=null,t.search.input=null,a.inputElement.focus(),u(function(){angular.element(n.find(".f-dropdown"))[0].style.display="none",a.inputElement.focus()},0,!1)),13===e.keyCode&&(e.preventDefault(),a.isLocked=!0)}}}}]).directive("onesiteSearchMainTypeaheadMobile",[function(){return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchMainTypeaheadImpl",templateUrl:"/onesite_modules/onesite-search/partials/typeahead/default.html",link:function(e,t,n,a){e.init(),e.submit.callback=function(){a.redirect.call(e),a.inputElement.trigger($.Event("keydown",{keyCode:27})),a.inputElement.focus()}}}}]).directive("onesiteSearchMainTypeaheadDefault",[function(){return{restrict:"E",scope:!1,replace:!0,require:"^onesiteSearchMainTypeaheadImpl",templateUrl:"/onesite_modules/onesite-search/partials/typeahead/default.html",link:function(e,t,n,a){e.init(),e.submit.callback=function(){a.redirect.call(e)}}}}]).directive("onesiteSearchTagAnchor",["urlConfig","languageService",function(a,i){return{restrict:"E",scope:{queryKey:"@",queryVal:"@",analyticsEvent:"@"},replace:!0,template:['<a href="{{ url }}"',"analytics-on",'analytics-category="Tags"','analytics-event="{{ ::analyticsEvent }}"','analytics-label="{{ queryVal }}">',"{{ queryVal }}","</a>"].join(" "),link:function(e){var t,n;e.url=[[a.pathPrefix,a.routes.searchResults[i.currentLanguage.get()].default].join("/"),(t=e.queryKey,n=e.queryVal,[t,encodeURIComponent(n)].join("="))].join("?")}}}]).directive("onesiteBreadcrumbs",[function(){return{restrict:"E",scope:{breadcrumb:"="},replace:!0,template:'<a analytics-on analytics-category="Header" analytics-event="breadcrumbs" analytics-label="{{breadcrumb.name}}" href="{{breadcrumb.path}}">{{breadcrumb.name}}</a>'}}]);
"use strict";angular.module("onesite.search.controllers",[]).controller("OnesiteSearchImpl",["numberService","$filter",function(i,n){var r=this;r.waited=!1,setTimeout(function(){r.waited=!0},1e3);var a={type:"!promoted_content"},c={type:"promoted_content"};r.appendToResultList=function(e,t){r.resultList=r.resultList.concat(n("filter")(e.resultList,a)),r.promotedResultList=r.promotedResultList.concat(n("filter")(e.resultList,c)),r.pagination=i.paginate.call(r.resultList,r.config.pageSize),t&&(r.total=e.total-r.promotedResultList.length)},r.initResultList=function(e){return r.pageIdx=0,r.total=null,r.pagination=[],r.resultList=[],r.promotedResultList=[],r.appendToResultList(e,!0),e}}]).controller("OnesiteSearchMainTypeaheadImpl",["urlConfig","analyticsTypeaheadService","redirectService","scopeService","stringService","$filter","$parse",function(r,a,c,e,t,s,i){var o=this;o.cacheInput=null,o.isLocked=null,o.clearInput=function(){var e=this;angular.isString(e.search.input)&&""!==e.search.input||(o.cacheInput=null,e.search.input=null)},o.tabThroughSuggestions=function(){o.cacheInput&&(this.search.input=o.cacheInput)};var u=function(){angular.isString(o.cacheInput)&&""!==o.cacheInput.trim()&&c.redirectTo([[r.pathPrefix,r.routes.searchResults[e.getMainController().node.content.lang].default].join("/"),["query",encodeURIComponent(o.cacheInput)].join("=")].join("?"))},l=i("input.alias.url");o.redirect=function(){var e=this,t=l(e.search);if(e.search.input)if(o.inputElement.blur(),t===r.pathPrefix)e.search.input=o.cacheInput,u(),a("Header","Search");else if(angular.isString(e.search.input)&&""!==e.search.input.trim())u(),a("Header","Search");else if(t){var i=o.cacheInput;o.cacheInput=e.search.input.title;var n=s("analyticsAutocompleteType")(e.search.input.type);a("Search","Autocomplete"+n,[i,t,e.search.input.title],e.search.input.index),c.redirectTo(t)}else e.search.input=o.cacheInput,u(),a("Header","Search");else o.isLocked?o.isLocked=!1:u()}}]).controller("onesiteSearchLandRegistration",["$scope","onesiteSearchLandRegistrationFilters",function(e,t){e.optionCollection=t}]);
/*
     FILE ARCHIVED ON 00:45:22 Mar 13, 2020 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 21:30:49 Mar 20, 2020.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  load_resource: 57.767
  exclusion.robots: 0.234
  captures_list: 906.669
  LoadShardBlock: 69.111 (4)
  exclusion.robots.policy: 0.218
  esindex: 0.019
  PetaboxLoader3.datanode: 78.346 (5)
  PetaboxLoader3.resolve: 42.288
  CDXLines.iter: 81.237 (4)
  RedisCDXSource: 1.996
*/